<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UAL Login Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Tailwind per stile base -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ UAL Core -->
  <script src="https://cdn.jsdelivr.net/npm/ual@2.0.0/dist/ual.min.js"></script>

  <!-- ✅ Authenticators (versioni funzionanti) -->
  <script src="https://cdn.jsdelivr.net/npm/ual-anchor/dist/ual-anchor.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ual-wax/dist/ual-wax.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ual-wombat/dist/ual-wombat.min.js"></script>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen">

  <div id="auth-button-container" class="text-center">
    <!-- Il bottone e il messaggio verranno generati da JS -->
  </div>

  <script>
    async function initApp() {
      console.info("[🔍] Inizio funzione initApp...");

      if (typeof Anchor === "undefined") {
        console.error("[❌] Anchor non è definito. La libreria non è stata caricata.");
        return;
      }

      const appName = "UAL Demo";
      const chain = {
        chainId: "1064487b3cd1a897a9dd1b404ad17b8462923c063053f08d7340a1ade8e3e43b",
        rpcEndpoints: [{
          protocol: "https",
          host: "wax.greymass.com",
          port: 443
        }]
      };

      const anchor = new Anchor.AnchorAuthenticator([chain], { appName });
      const waxAuth = new waxjs_ual.WaxAuthenticator([chain], { appName });
      const wombat = new wombat_ual.Wombat([chain], { appName });

      const ual = new UAL.UAL([chain], appName, [anchor, waxAuth, wombat]);
      window.ual = ual;

      const container = document.getElementById("auth-button-container");

      const welcome = document.createElement("span");
      welcome.className = "ml-4 font-semibold text-green-400";

      const btn = document.createElement("button");
      btn.className = "bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded";
      btn.textContent = "Login";
      container.appendChild(btn);
      container.appendChild(welcome);

      btn.addEventListener("click", () => {
        if (ual.activeUser) {
          ual.logout();
          welcome.textContent = "";
          btn.textContent = "Login";
          console.info("[🚪] Logout eseguito.");
        } else {
          ual.init().then(() => ual.showModal());
        }
      });

      const checkLogin = setInterval(async () => {
        if (ual && ual.activeUser) {
          clearInterval(checkLogin);
          const account = await ual.activeUser.getAccountName();
          welcome.textContent = `Welcome ${account}`;
          btn.textContent = "Logout";
          console.info("[✅] Login con successo:", account);
        }
      }, 1000);
    }

    window.addEventListener("load", initApp);
  </script>
</body>
</html>
