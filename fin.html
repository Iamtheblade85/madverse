<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>Finance Calendar Dashboard</title>

  <!-- CSS theme -->
  <link rel="stylesheet" href="fin-theme.css" />

  <!-- Optional: better rendering on mobile -->
  <meta name="theme-color" content="#0b1220" />
</head>

<body>
  <!-- APP ROOT -->
  <div id="app" class="app layout">

    <!-- TOPBAR -->
    <header id="topbar" class="topbar" role="banner">
      <div class="topbar__left">
        <button id="btnSidebarToggle" class="btn btn--ghost" type="button" aria-label="Apri/chiudi pannello filtri">
          ☰ Filtri
        </button>

        <button id="btnPrev" class="btn btn--icon" type="button" aria-label="Periodo precedente">‹</button>
        <button id="btnToday" class="btn btn--ghost" type="button" aria-label="Vai a oggi">Oggi</button>
        <button id="btnNext" class="btn btn--icon" type="button" aria-label="Periodo successivo">›</button>

        <span id="rangeLabel" class="topbar__range" aria-live="polite">—</span>
      </div>

      <div class="topbar__right">
        <!-- View switch -->
        <div id="viewSwitch" class="segmented" role="group" aria-label="Cambia vista calendario">
          <button class="btn btn--seg" type="button" data-view="day" aria-pressed="false">Giorno</button>
          <button class="btn btn--seg" type="button" data-view="week" aria-pressed="false">Settimana</button>
          <button class="btn btn--seg" type="button" data-view="month" aria-pressed="true">Mese</button>
          <button class="btn btn--seg" type="button" data-view="year" aria-pressed="false">Anno</button>
        </div>

        <!-- Density -->
        <div id="densitySwitch" class="segmented" role="group" aria-label="Densità visualizzazione">
          <button class="btn btn--seg" type="button" data-density="comfort" aria-pressed="true">Comfort</button>
          <button class="btn btn--seg" type="button" data-density="compact" aria-pressed="false">Compatta</button>
        </div>

        <button id="btnNewEvent" class="btn btn--primary" type="button" aria-label="Crea nuovo evento">
          ＋ Nuovo
        </button>
      </div>
    </header>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar" data-open="true" aria-label="Filtri e impostazioni">
      <div class="sidebar__header">
        <h2 class="sidebar__title">Filtri</h2>
      </div>

      <!-- Search -->
      <section class="sidebar__section" aria-label="Ricerca">
        <div class="sidebar__section-title">Ricerca</div>
        <label class="label" for="searchInput">Cerca titolo / categoria / note</label>
        <input id="searchInput" type="search" placeholder="Es. affitto, auto, stipendio…" autocomplete="off" />
      </section>

      <!-- Category -->
      <section class="sidebar__section" aria-label="Categoria">
        <div class="sidebar__section-title">Categoria</div>
        <label class="label" for="categorySelect">Seleziona categoria</label>
        <select id="categorySelect">
          <option value="all">Tutte</option>
        </select>
        <small class="help">Le categorie vengono generate automaticamente dagli eventi.</small>
      </section>

      <!-- Type toggles -->
      <section class="sidebar__section" aria-label="Tipi evento">
        <div class="sidebar__section-title">Tipi</div>

        <div class="toggle">
          <span class="toggle__label">Entrate</span>
          <input id="toggleIncome" type="checkbox" checked />
        </div>

        <div class="toggle" style="margin-top:10px;">
          <span class="toggle__label">Uscite</span>
          <input id="toggleExpense" type="checkbox" checked />
        </div>

        <div class="toggle" style="margin-top:10px;">
          <span class="toggle__label">Altro</span>
          <input id="toggleOther" type="checkbox" checked />
        </div>
      </section>

      <!-- Range presets -->
      <section class="sidebar__section" aria-label="Range date">
        <div class="sidebar__section-title">Range</div>

        <div id="rangePresets" class="pill-row" role="group" aria-label="Preset range">
          <button class="btn btn--pill" type="button" data-preset="all" aria-pressed="true">Da inizio</button>
          <button class="btn btn--pill" type="button" data-preset="from" aria-pressed="false">Da data</button>
          <button class="btn btn--pill" type="button" data-preset="between" aria-pressed="false">Tra date</button>
        </div>

        <label class="label" for="fromDate">Da</label>
        <input id="fromDate" type="date" />

        <label class="label" for="toDate">A</label>
        <input id="toDate" type="date" />
      </section>

      <!-- Actions -->
      <section class="sidebar__section" aria-label="Azioni">
        <div class="sidebar__section-title">Azioni</div>

        <button id="btnApplyFilters" class="btn btn--primary" type="button">Applica</button>
        <button id="btnClearFilters" class="btn btn--ghost" type="button" style="margin-top:10px;">Reset</button>

        <hr />

        <button id="btnExport" class="btn btn--ghost" type="button">Esporta JSON</button>
        <label class="label" for="importFile" style="margin-top:12px;">Importa JSON</label>
        <input id="importFile" type="file" accept="application/json" />
      </section>

      <!-- Stats panel -->
      <section id="statsPanel" class="sidebar__section" aria-label="Statistiche">
        <div class="sidebar__section-title">
          <span>Stats</span>
          <small id="statsMeta">—</small>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-card__label">Saldo attuale</div>
            <div id="statCurrentBalance" class="stat-card__value">—</div>
          </div>

          <div class="stat-card">
            <div class="stat-card__label">Netto</div>
            <div id="statNet" class="stat-card__value">—</div>
            <div class="stat-card__sub">
              <span id="statIncomeCount">—</span> · <span id="statExpenseCount">—</span>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-card__label">Entrate</div>
            <div id="statIncome" class="stat-card__value">—</div>
          </div>

          <div class="stat-card">
            <div class="stat-card__label">Uscite</div>
            <div id="statExpense" class="stat-card__value">—</div>
          </div>
        </div>

        <hr />

        <div class="sidebar__section-title" style="margin-top:6px;">Snapshot (ultimi 14)</div>
        <div id="snapshotList" class="snapshot-list" role="list"></div>
      </section>
    </aside>

    <!-- MAIN -->
    <main id="main" class="main" role="main">
      <header class="main__header">
        <h1 id="calendarTitle">Calendario</h1>
        <p id="calendarSubtitle">—</p>
      </header>

      <section id="calendarView" class="calendar" aria-label="Vista calendario"></section>
    </main>
  </div>

  <!-- EVENT DRAWER (side panel) -->
  <aside id="eventDrawer" class="drawer" aria-hidden="true" aria-label="Dettaglio evento">
    <div id="eventDrawerHeader" class="drawer__header">
      <h2 id="drawerTitle">Evento</h2>
      <div class="drawer__actions">
        <button id="btnEditEvent" class="btn" type="button">Modifica</button>
        <button id="btnDeleteEvent" class="btn" type="button">Elimina</button>
        <button id="btnCloseDrawer" class="btn btn--icon" type="button" aria-label="Chiudi">✕</button>
      </div>
    </div>
    <div id="eventDetail" class="drawer__body"></div>
  </aside>

  <!-- EVENT MODAL -->
  <dialog id="eventModal" aria-label="Crea o modifica evento">
    <div id="eventModalHeader" class="modal__header">
      <h2 id="eventModalTitle">Evento</h2>
      <button id="btnCloseModal" class="btn btn--icon" type="button" aria-label="Chiudi">✕</button>
    </div>

    <form id="eventForm" method="dialog" autocomplete="off">
      <div class="form-field">
        <label class="label" for="evtTitle">Titolo *</label>
        <input id="evtTitle" type="text" placeholder="Es. Affitto, Stipendio, Assicurazione…" required />
      </div>

      <div class="form-field">
        <label class="label" for="evtCategory">Categoria</label>
        <input id="evtCategory" type="text" list="categoryList" placeholder="Es. Casa, Auto, Lavoro…" />
        <datalist id="categoryList"></datalist>
      </div>

      <div class="form-field">
        <label class="label" for="evtType">Tipo</label>
        <select id="evtType">
          <option value="income">Entrata</option>
          <option value="expense">Uscita</option>
          <option value="other">Altro</option>
        </select>
      </div>

      <div class="form-field">
        <label class="label" for="evtAmount">Importo</label>
        <input id="evtAmount" type="number" step="0.01" placeholder="Es. 950" />
      </div>

      <div class="form-field">
        <label class="label" for="evtStart">Data *</label>
        <input id="evtStart" type="date" required />
      </div>

      <div class="form-field">
        <label class="label" for="evtTime">Ora</label>
        <input id="evtTime" type="time" />
      </div>

      <div class="form-field">
        <label class="label" for="evtRecurrence">Ricorrenza</label>
        <select id="evtRecurrence">
          <option value="none">Nessuna</option>
          <option value="monthly">Mensile</option>
          <option value="yearly">Annuale</option>
          <option value="custom_days">Ogni N giorni</option>
        </select>
      </div>
      
      <!-- Campo extra: visibile solo se custom_days -->
      <div id="recDaysField" class="form-field" style="display:none;">
        <label class="label" for="evtRecurrenceDays">Ogni quanti giorni?</label>
        <input id="evtRecurrenceDays" type="number" min="1" step="1" placeholder="Es. 7" />
      </div>

      <div class="form-field" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <label class="label" for="evtPinned" style="margin:0;">In evidenza</label>
        <input id="evtPinned" type="checkbox" />
      </div>

      <div class="form-field" style="grid-column: 1 / -1;">
        <label class="label" for="evtNotes">Note</label>
        <textarea id="evtNotes" placeholder="Dettagli, scadenze, note personali…"></textarea>
      </div>
    </form>

    <div id="eventModalFooter" class="modal__footer">
      <button id="btnCancelEvent" class="btn btn--ghost" type="button">Annulla</button>
      <button class="btn btn--primary" type="submit" form="eventForm">Salva</button>
    </div>
  </dialog>

  <!-- JS -->
  <script src="fin.js" defer></script>
</body>
</html>
