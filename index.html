<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>ChipsWallet - Wax Chain Project</title>
</head>
<body>

<div class="container">
  <!-- Logo con cerchio dorato rimbalzante -->
  <div class="logo">ChipsWallet</div>
  <div class="golden-circle"></div>
  
  <!-- Titolo con cerchio rotante -->
  <div class="title-container">
    <div class="title-circle">C</div>
    <h1 class="section-title">Wax Chain Project</h1>
  </div>

  <!-- Layout principale con sidebar e content frame -->
  <div class="main-layout">
    <div class="sidebar">
      <div class="welcome-message" id="welcome-message">Welcome, {wax_account}</div>
      <div class="menu">
        <button onclick="loadContent('balance')"><i>üíº</i>Wallet</button>
        <button onclick="loadContent('staking_farms')"><i>üå±</i>Staking</button>
        <button onclick="loadContent('mynfts')"><i>üé®</i>NFTs Inventory</button>
        <button onclick="loadContent('waxdao_pools')"><i>üè¶</i>Pools</button>
        <button onclick="loadContent('profile')"><i>üë§</i>Account</button>
      </div>
    </div>

    <!-- Frame per il contenuto dinamico -->
    <div class="content-frame" id="content-frame">
      <p>Select an option from the menu.</p>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    ChipsWallet @2024 - A Wax Chain Project
  </div>
</div>

<script>
  // Funzione per ottenere i parametri URL
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  const userId = getQueryParam("user_id");
  let user_wax_account = null;

  // Funzione per ottenere l'account Wax dell'utente
  async function fetchWaxAccount() {
    const response = await fetch(`https://iamemanuele.pythonanywhere.com/profile?user_id=${userId}`);
    const data = await response.json();
    if (response.ok && data.wax_account) {
        user_wax_account = data.wax_account;
        document.getElementById("welcome-message").textContent = `Welcome, ${user_wax_account}`;
    } else {
        document.getElementById("welcome-message").textContent = `Welcome, User`;
    }
  }

  // Funzione per caricare contenuti dinamici
  async function loadContent(page) {
    const contentFrame = document.getElementById("content-frame");
    let url;

    switch(page) {
      case 'balance':
        url = `https://iamemanuele.pythonanywhere.com/saldo?user_id=${userId}`;
        break;
      case 'staking_farms':
        url = `https://iamemanuele.pythonanywhere.com/open_pools?user_id=${userId}`; 
        break;
      case 'mynfts':
        url = `https://iamemanuele.pythonanywhere.com/mynfts?user_id=${userId}`;
        break;
      case 'waxdao_pools':
        loadNFTFarms();
        return;
      case 'profile':
        url = `https://iamemanuele.pythonanywhere.com/profile?user_id=${userId}`;
        break;
    }
    
    const response = await fetch(url);
    const data = await response.json();

    if (page === 'balance' && response.ok) {
        contentFrame.innerHTML = `
            <h2 class="pool-title">Your Token Balances</h2>
            <div class="balance-grid">
              ${data.balances.map(balance => `
                  <div class="balance-item">
                    <h4>${balance.token_symbol}</h4>
                    <p style="text-align: left;"><span class="value">${balance.amount}</span></p>
                  </div>
              `).join("")}
            </div>`;
    }
    else if (page === 'staking_farms' && response.ok) {
        contentFrame.innerHTML = `
            <h2 class="pool-title">Staking Farms</h2>
            <div class="staking-grid">
              ${data.pools.map(farm => `
                  <div class="staking-item">
                    <h4>üå± ${farm.farm_name}</h4>
                    <p><span class="label">APR:</span> <span class="value">${farm.apr}%</span></p>
                  </div>
              `).join("")}
            </div>`;
    } else if (page === 'mynfts' && response.ok) {
        contentFrame.innerHTML = `
          <h2 class="section-title">Your NFTs Inventory</h2>
          <div class="nft-grid">
            ${data.nfts.map(nft => `
              <div class="nft-item">
                <img src="${nft.image_url}" alt="NFT Image" class="nft-image">
                <div class="nft-details">
                  <p><span class="label">ID:</span> <span class="value">${nft.nft_id}</span></p>
                  <p><span class="label">Asset ID:</span> <span class="value">${nft.asset_id}</span></p>
                  <p><span class="label">Status:</span> <span class="value">${nft.is_staked}</span></p>
                  <p><span class="label">On Sale:</span> <span class="value">${nft.for_sale}</span></p>
                </div>
              </div>
            `).join("")}
          </div>`;
    }  else if (page === 'profile' && response.ok) {
          contentFrame.innerHTML = `
            <h2 class="pool-title">Your Profile</h2>
            <p><strong>Username:</strong> ${data.username}</p>
            <p><strong>Level:</strong> ${data.sqj_level}</p>
            <p><strong>Account:</strong> ${data.wax_account}</p>`;
    } else {
      contentFrame.innerHTML = `<p>Error loading ${page}: ${data.error}</p>`;
    }
  }

  // Funzione per caricare le farms NFT
  async function loadNFTFarms(viewType = 'all') {
    const contentFrame = document.getElementById("content-frame");
    const userId = getQueryParam("user_id");
    let url = `https://iamemanuele.pythonanywhere.com/nfts_farms?user_id=${userId}`;

    if (viewType === 'user_staking') {
        url += "&view=user_staking";
    }

    const response = await fetch(url);
    const data = await response.json();

    if (response.ok && data.farms) {
        contentFrame.innerHTML = `
          <div class="switch-container">
            <button onclick="loadNFTFarms('all')" ${viewType === 'all' ? 'class="active"' : ''}>All Pools</button>
            <button onclick="loadNFTFarms('user_staking')" ${viewType === 'user_staking' ? 'class="active"' : ''}>My Staked Pools</button>
          </div>
          <h2 class="pool-title">Active NFTs Farms</h2>
          <div class="pool-grid">
            ${data.farms.map(farm => `
              <div class="pool-item">
                <h4>üè¶ ${farm.farm_name}</h4>
                <p><span class="label">Reward:</span> <span class="value">${farm.reward_token}</span></p>
              </div>
            `).join("")}
          </div>
        `;
    } else {
        contentFrame.innerHTML = `<p>Error loading pools: ${data.error}</p>`;
    }
  }
  
  // Carica i dati dell'account all'avvio
  fetchWaxAccount();
</script>
</body>
</html>
